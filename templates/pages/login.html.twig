{% extends "layouts/auth_layout.html.twig" %}

{% block content %}
<main class="min-h-screen flex items-center justify-center bg-gray-50 px-4">
  <div class="w-full max-w-5xl px-4 sm:px-6 lg:px-8">
    <div
      class="flex flex-col md:flex-row items-center gap-8 w-full md:w-auto p-6 sm:p-8 bg-white rounded-2xl shadow-lg mx-auto fade-slide"
    >
      {# Left side: Logo & Text #}
      <div
        class="flex flex-col items-center md:items-start text-center md:text-left md:w-1/2 gap-4"
      >
        <img src="/assets/logo.png" alt="AfriTicket Logo" class="h-16 mb-2" />
        <h2 class="text-3xl font-bold text-gray-800">Welcome Back</h2>
        <p class="text-gray-600">
          Log in to manage your events and tickets seamlessly.
        </p>
      </div>

      {# Right side: Form #}
      <form
        method="POST"
        action="/login"
        class="flex flex-col gap-4 w-full md:w-1/2"
      >
        {# CSRF Token placeholder, if implemented manually #}
        {% if csrf_token is defined %}
          <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
        {% endif %}

        <label class="block">
          <span class="text-sm font-medium text-gray-700">Email</span>
          <input
            type="email"
            name="email"
            placeholder="you@example.com"
            class="mt-1 w-full border px-3 py-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
            required
          />
        </label>

        <label class="block">
          <span class="text-sm font-medium text-gray-700">Password</span>
          <input
            type="password"
            name="password"
            placeholder="********"
            class="mt-1 w-full border px-3 py-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
            required
          />
        </label>

        {# Optional error message from backend #}
        {% if error is defined and error %}
          <p class="text-red-600 text-sm mt-1">{{ error }}</p>
        {% endif %}

        <button
          type="submit"
          class="w-full py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition disabled:opacity-50"
        >
          Login
        </button>

        <p class="mt-2 text-center text-gray-600 text-sm">
          Don't have an account?
          <a href="/signup" class="text-blue-600 hover:underline font-medium">
            Create account
          </a>
        </p>
      </form>
    </div>
  </div>
</main>

<style>
  .fade-slide {
    opacity: 0;
    transform: translateY(50px);
    animation: fadeSlideIn 0.6s ease forwards;
  }
  @keyframes fadeSlideIn {
    from {
      opacity: 0;
      transform: translateY(50px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script src="/assets/js/storage.js"></script>
<script src="/assets/js/fakeApi.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.querySelector("form");
  const button = form.querySelector("button[type='submit']");
  const errorBox = document.createElement("p");
  errorBox.className = "text-red-600 text-sm mt-1 hidden";
  form.appendChild(errorBox);

  const showError = msg => {
    errorBox.textContent = msg;
    errorBox.classList.remove("hidden");
  };

  const showSuccess = msg => {
    errorBox.textContent = msg;
    errorBox.classList.remove("hidden");
    errorBox.classList.replace("text-red-600", "text-green-600");
  };

  form.addEventListener("submit", async e => {
    e.preventDefault();
    errorBox.classList.add("hidden");
    button.disabled = true;

    const formData = Object.fromEntries(new FormData(form).entries());

    try {
      {% if app.request.getPathInfo() == '/signup' %}
        await FakeApi.signup(formData);
        showSuccess("Account created! Redirecting...");
      {% else %}
        await FakeApi.login(formData);
        showSuccess("Login successful! Redirecting...");
      {% endif %}

      setTimeout(() => {
        window.location.href = "/dashboard";
      }, 1000);
    } catch (err) {
      showError(err.message || "Something went wrong.");
    } finally {
      button.disabled = false;
    }
  });
});
</script>

{% endblock %}
